# Ray Tracing Gems || 学习笔记

## 1.从摄影到光追

摄影是一项以物理光学和电磁学为基础的技术。当我们讨论光线追踪的渲染技术时，我们实际上就是在模拟一个真实的物理相机摄像的过程，因此，了解摄影技术和摄影词汇有利于加深对光追的学习。

* **摄影技术**：通过捕获光子来描述事物或表达思想。
* **摄影机**：一种捕获光子的设备，可以将光子信息存入存储媒介中以供查看。
* **光电探测器**：一种无源电子元件，可以将光子信息转换为电流信号；光电探测器的相应曲线通常是非线性的，这一点和光敏二极管类似。
* **图素**：一个光电探测器（感光点）或者一个像素。
* **传感器**：一个对齐笛卡尔坐标系的图素平面；传感器负责采样光子信息并且将产生的电流信号数字化。
* **传感器模块**：一种电气模块，包含数字传感器和所有相关的滤光片。每一种传感器模块都有一个唯一的传递函数，这是由各种各样的因素导致的，在模拟中一般不需要对传感器进行完全建模。如果真的需要对一种特定的传感器模块进行模拟，通常采取的策略是直接对传感器进行采样建模，获得一张类似光学光谱灵敏度的图片。

- **像素间距**：相邻的两个像素中心的物理距离，通常以微米（$$10^{-6}$$米）为单位。

- **红外/紫外线滤光片**：一种放在传感器前面的滤光片，用以吸收红外线和紫外线；虽然不同光电探测器之间的差距可能非常大，但大部分相机的光电探测器都对可见光波段以外的波长很敏感。使用红外/紫外线滤光片可以更好地模拟人眼的感光效果。

- **黑白传感器模块**：使用红外/紫外线滤光片的图素网格，每一个图素都捕获了所有进入其中的可见光波段的光子；黑白传感器模块仅捕获光子的亮度信息，不包含颜色信息。

- **颜色传感器**：由黑白传感器模块增加一块彩色马赛克滤光片组成。马赛克滤光片由多个彩色滤光片图案重复排列形成，每个彩色滤光片图案都覆盖一个独立像素。彩色滤光片一般由红、绿、蓝、透明组成，红色滤光片模拟人眼的红视锥（L型视锥细胞，Long Cone），绿色滤光片模拟人眼的绿视锥（M型视锥细胞，Middle Cone），蓝色滤光片模拟人眼的蓝视锥（S型视锥细胞，Short Cone）。颜色传感器可以近似地将透过马赛克图案的亮度和颜色信息转变为RGB信息。

- **Bayer图案**：最常使用的马赛克图案，由两绿一红一蓝组成。Bayer图案可以捕获约45%的亮度信息和约29%的颜色信息。

- **去马赛克**：一种近似完整RGB颜色信息的信号处理算法。不同的马赛克图案对应不同的算法。去马赛克之前，传感器中的每个像素只有单一的颜色或亮度值，而完整RGB颜色信息则是要求每个像素都具备RGB三个值。

- **Foveon传感器**：一种通过半导体中垂直堆叠三个光敏二极管组成的传感器，可以免去对马赛克图案的依赖而获得完整的RGB颜色信息。

- **走样（Aliasing）**：信号采集和还原的过程中产生的失真或瑕疵。这种问题常出现在具有高频信息的地方。

- **抗走样滤光片**：一种位于传感器之前用于减少走样问题的滤光片。实际上是一种光学模糊元件，可以减少传递到传感器的高频信息（低通滤镜），对消除摩尔纹尤其有效。

- **摩尔纹**：一种视觉走样效果，当图素的空间频率与高频信息接近时产生的干扰图案。

- **胶片**：一种光子捕获和存储媒介，通常是一种具有光敏化学材料涂层的塑料片。

- **阴片**：胶片的存储媒介，具有光反特性，即增加光子数量会使得底片变暗。底片的输出内容实际上是反转的亮度和颜色信息。

- **阳片**：具备光正特性的胶片，输出内容是正常的亮度和颜色信息。

- **35mm胶片**：宽度为35毫米的胶片，是20世纪最常使用的胶片。

- **65mm胶片**：宽度为70毫米的胶片。因为一些历史原因，70毫米胶片有时候会标注为65毫米胶片，但实际上所谓的“65毫米胶片”没有任何维度上是65毫米。

- **Aspect Ratio**：（画幅）宽高比，宽度与高度的比值。对胶片来说，是指感光区域的宽高比；对数字传感器来说，是指水平方向像素数量和垂直方向像素数量的比值。

- **35mm摄影胶片**：宽为36毫米，高为24毫米，宽高比为3:2的胶片。

- **35mm电影胶片**：由于电影胶片在水平方向的边缘有音频带，所以35mm电影胶卷的实际画面相当于宽为22毫米，高为16毫米，宽高比为1.375:1的胶片。

- **35mm传感器**：全画幅传感器，模拟35mm摄影胶片感光效果的数字传感器，为一块尺寸为36mm\*24mm的传感器。

- **APS-C**：APS-C画幅，感光面积约为全画幅的一半，传感器尺寸约为23.4mm\*15.6mm。

- **4/3传感器**：感光面积约为全画幅的1/4，传感器尺寸约为17.3mm\*13mm，宽高比为4:3。但4/3不是由于它的画幅比为4:3，而是指感光原件规格等效于过去的4/3英寸直径摄像管。

- **Super 35mm**：模拟35毫米电影胶片的感光效果；传感器尺寸为24.89mm\*18.66mm，宽高比为1.33:1。

- **中画幅**：指比35毫米摄影胶片感光面积更大，但是比大画幅感光面积小的画幅。具体来说是指感光面积在36mm\*24mm到130mm\*100mm之间的画幅（对画幅比没有规定）。

- **大画幅（摄影）**：指感光面积大于130mm\*100mm的画幅。

- **大画幅（电影）**：指感光面积大于Super 35mm的画幅。

- **DCI-2K**：像素分辨率为2048\*1080

- **DCI-4K**：像素分辨率为4096\*2160

- **DCI-8K**：像素分辨率为8192\*4320

- **High-Definition（高清）**：像素分辨率为1920\*1080

- **Ultra-High-Definition（超清）**：像素分辨率为3840\*2160

- **8K**：像素分辨率为7680\*4320

- **透镜化**：一种将水平光线汇聚到一点的数学运算，通常用薄透镜模型描述。

- **焦点**：透镜化过程中光线汇聚的点。

- **摄影镜头**：一套由光学元件构成的物理组件，用于将进入的光子汇聚到感光区域前的焦点上。

- **视场**：通过镜头汇聚到焦点上的可见范围，通常用立体角表示。当画幅确定时，视场大小和焦距可以相互求得。

- **水平视场**：描述视场在水平方向的最大开角。

- **垂直视场**：描述视场在垂直方向的最大开角。

- **针孔相机**：是一个黑盒结构，选出其中一个面开一个小孔，相对的面作为感光区域。其中的小孔就是针孔相机的焦点（区域）。理想针孔相机的小孔是非常小的，几乎没有离焦模糊，但这样也会使得进光量很少。

- **焦距**：焦点到相交平面的距离，相交平面是指汇聚线反向延长线与平行光线相交的平面。

- **焦距、视场与画幅大小的关系**：

  $$h_{fov}=2arctan(\frac{画幅宽度}{2\times焦距})\qquad v_{fov}=2arctan(\frac{画幅高度}{2\times焦距})$$

- **光圈（虹膜）**：摄影机镜头上的开口，是光子进入感光区域的唯一入口。可更换镜头的光圈一般也是可以调节的。较大的光圈可以提高进光量，但也会产生更大的弥散圈；较小的光圈减少了进光量，但可以缩小弥散圈。摄影圈一般使用“光圈（aperture）”这个词，影视制作一般使用“虹膜（iris）”这个词，它们其实是相同的概念。

- **弥散圈**：由前后相邻的光锥堆积产生的光学模糊现象。弥散圈的半径大小与光圈大小直接相关。

- **焦平面**：过焦点，与透镜中轴线垂直的理想平面。处于焦平面的物体会在传感器上得到最清晰的成像。

- **离焦模糊**：由弥散圈引起的模糊现象。处于焦平面之外的物体会显得模糊。

- **景深**：近焦平面与远焦平面的距离。处于这两个平面内的物体会显得清晰，不处于这两个平面内的物体会出现离焦模糊。

  ![](笔记材料\景深.jpeg)

- **STOP**：级数，每一级stop都是将数值翻倍，$$1 stop就是2\times，2 stops就是4\times，3 stops就是8\times...$$

- **入瞳**：孔径光阑在物空间的共轭像，也就是孔径光阑对前方光学系统所成的像。

  ![](D:\Projects\RayTracing\RayTracingRenderer\笔记材料\孔径光阑.PNG)

- **光圈值**：焦距对入瞳直径的比值（相对孔径），也被称为*f*值。当光圈宽度（光阑孔径）减小时，光圈值变大。需要注意，这里的*f*值并不是指焦距，而是指相对孔径大小。

- **F-Stop**：一种量化的光圈值。f-stop通常都按$$\sqrt{2}$$的倍数设计，比如f1.4，f2.0，f2.8等等，也有些是根据$$\sqrt{2/3}$$的倍数设计，比如f1.4，f1.6，f1.8，f2.0等等。当一个镜头的f-stop标为f2.0时，就意味着该镜头的焦距是入瞳直径的两倍。

- **透射率**：光线穿过镜头的通过率。当光线100%的能量都可以穿透镜头，那么该镜头的透射率即为1.0。镜头当中的连续结构可能会使光子被吸收或者反弹回去，而使得透射率低于1.0。常见的透射率一般在0.7~0.9之间。

- **T-Stop**：一种量化的光阑值。t-stop和f-stop的关系为：$$T=\frac{f-stop}{\sqrt{透射率}}$$

  举例：一个透射率为0.7的f2.0镜头和一个透射率为1.0的f2.4镜头的进光量是基本相同的。

- **快门速度**：感光区域的感光时间。

- **帧频**：拍摄视频时的每秒画面数量。常用的帧频有24fps、NTSC-23.976fps、30fps、NTSC-29.97fps、PAL-25fps，帧频低于快门速度。

- **快门角度**：通过帧频标准化的旋转快门角度，用于控制视频拍摄时的每帧图片的感光时间，计算公式为：$$快门角度=快门速度\times帧频\times360\degree$$

- **180°规则**：当快门角度为180°时，拍摄出来的视频会有非常顺滑的运动模糊。

- **卷帘快门**：卷帘快门的感光采样会按照一定的顺序进行，通常是从左上角到右下角，其中的感光延迟会导致各部分像素的时间不同步，引发“果冻效应”。

- **全局快门**：全局快门的感光采样时同时发生的，不会出现“果冻效应”。

- **曝光**：捕获光线数量的量化参数。焦平面的曝光值公式为：$$exposure=\frac{Lt\pi(U-f)^2TChcos^4(\theta)}{4A^2U^2}$$

  其中，L是场景亮度值，*t*是快门时间，*U*是场景到焦平面的距离，*f*是镜头的焦距，*A*是镜头的*f*值，*T*是镜头的透射率，*C*是相机的光斑修正系数，*h*是晕影（暗角）系数，*θ*是中轴线到像素点的夹角。

- **ISO/GAIN**：数字增强。常用的曝光调节参数有ISO（感光度）、EV（曝光值）、decibels（增益分贝）或者f-stop（光圈值）。ISO一般用在摄影领域，gain（增益）一般用在视频拍摄领域，但它们指同一个东西。这里的ISO是国际标准化组织的缩写，他们制定了感光度的国际标准。

- **CLIPPING**：曝光阈值，亮度超过该值时，感光区域无法衡量曝光值。数字传感器会确定感光区域所能记录的亮度上限，而胶片阴片的曝光阈值反映出来的则是亮度下限。数字传感器中的曝光阈值是由感光元件的计量溢出或者定点数溢出导致的。简单的光追渲染器通常会根据目标图片格式设定曝光阈值。

- **噪底**：对于数字传感器来说，是指信噪比低于某个特定值时的曝光值。这种噪声的主要来源有：光子噪声、暗电噪声、模拟信号读写噪声、数模转换噪声等。

- **动态范围**：对于数字传感器来说，是指曝光阈值对噪底的比值。

- **向右曝光**：使用数字传感器进行照片拍摄时，在没有过曝溢出的情况下尽可能使用最高的曝光值。向右曝光可以最大化地展现图片中阴影区域和高亮区域的细节，是数字传感器相机常用的曝光技巧。通常的曝光直方图都是从左向右为阴影到高亮的分布，向右曝光则是将曝光区间向右侧调整，使用原本右侧更高区间的曝光值来曝光本区间。

- **向左曝光**：使用胶片相机进行拍摄时，在没有曝光不足的情况下尽可能使用最低的曝光值。与向右曝光类似，向左曝光可以最大化地展现胶片中阴影区域和高亮区域的细节。

- **白平衡**：表示白色的颜色数值。相机和场景都有特定的白平衡数值。白平衡也可以通过色温、色相和饱和度调节。

- **对数录制**：在视频录制时采用对数曲线替代线性曲线记录画面的luma亮度。对于使用8bit或者10bit的位宽记录画面亮度的相机来说，最主要的噪声来源是进行数模转换时的量化噪声。将luma曲线用对数曲线压缩，可以减少量化噪声，降低数据占用，之后可以在后期编辑中还原来得到更大的动态范围。但对数录制的方式可能会增加向右曝光的复杂度。

- **原始录制**：视频录制的特殊模式，可以在后期编辑中获得更多的自由度。原始录制具体可以提供哪些在后期编辑中可以自由调节的参数，取决于厂家的设计。常见的参数有：ISO、白平衡。

- **构图**：配置画面中人和物的位置。调节画面中主体对象和次要对象的位置可以很大程度上改变画面的观感。

- **等效35mm**：一个标准化的体系，摄影师可以用该体系推断使用的相机和镜头参数。在该体系下，即使是非35mm底的镜头也可以用35mm底下的表现来描述，这让摄影师们可以更轻松地推断镜头所使用的视场、景深等参数。

- **裁剪因子**：是用于比较不同尺寸传感器感光尺度的系数。裁剪因子也有其他含义：对35mm底的比值（$$裁剪因子=\frac{传感器宽度}{36mm}$$），对35mm底的对角线的比值（$$裁剪因子=\frac{传感器对角线长度}{43mm}$$）

- **等效35mm焦距**：用镜头的焦距乘以镜头的裁剪因子（$$焦距\times裁剪因子$$）。

- **等效35mm曝光**：镜头的曝光值不随裁剪因子改变。

- **等效35mm景深**：镜头的景深不随裁剪因子改变。但如果想要保持画面构图不变，那就需要将景深乘以裁剪因子来获得新的景深。

- **等效35mm光圈**：这是一种很有用但是具有误导性的描述，它是将f-stop乘以裁剪因子来获得新的f-stop。f-stop作为光圈值，其实包含了景深和曝光信息。比如一个f1.8光圈的镜头可能会标注为“等效35mm f2.7光圈”，实际上是把f1.8乘以了裁剪因子1.5得到的。但这其实很有误导性，因为裁剪因子同时放大了景深，但曝光值却不受影响。所以，这个镜头实际上是“等效f2.7的景深”+“等效f1.8的曝光”。

- **定焦镜头**：焦距固定的镜头。

- **变焦镜头**：焦距可变的镜头。

- **超广角镜头**：等效35mm焦距小于24mm的镜头。

- **广角镜头**：等效35mm焦距在24mm~35mm之间的镜头。

- **标准镜头**：等效35mm焦距在35mm~60mm之间的镜头。

- **长焦镜头**：等效35mm焦距在60mm~200mm之间的镜头。

- **超长焦镜头**：等效35mm焦距大于200mm的镜头。

- **最小对焦距离**：传感器平面到镜头可以对焦的最小距离，或者说是像方焦平面到最近的物方焦平面的距离。

- **微距镜头**：最小对焦距离较短的镜头。微距镜头的参数一般标注为最小对焦距离上的放大倍数。一个标注为2:1的放大镜头，可以将物象按原尺寸的两倍投射到传感器上。

- **镜头视界（镜头覆盖范围）**：镜头投射到传感器上的直径。直径以外的部分会形成画面暗角。镜头视界为43mm的镜头刚好可以完整覆盖全画幅的底。

- **散景（bokeh）**：指照片中失焦的部分，词源出自于日语中的模糊（ぼける），通常用于表现焦平面之外的灯光。散景可以通过不同形状构成混叠圈，比如圆形、多边形。混叠圈的散开程度决定了散景效果的柔和度。

- **校正散景**：消费级镜头中最常见的散景类别。混叠圈中的光子会均匀地分布于整个混叠圈。在校正散景中，点光源会呈现出近似于面光源的效果。

- **过校散景**：混叠圈中的光子会主要分布于混叠圈的边缘处。在过校散景中，点光源会呈现出近似于肥皂泡的效果，所以该散景也被称为肥皂泡散景。许多老镜头都会有过校散景的效果，可以通过使用过校散景来营造一种老照片的感觉。

- **失校散景**：混叠圈中的光子会主要分布于混叠圈的中心。在失校散景中的物体会显得更加散开，进一步加强了聚焦平面和失焦平面的差别。

- **光圈叶片**：光圈叶片是调节光圈直径的组件。光圈叶片会使得离焦模糊的部分呈现出多边形。

- **猫眼散景**：照片中离焦模糊的部分呈现出猫眼的形状。对于非球面镜头，外围的散景可以通过横向压缩得到椭圆状的离焦模糊。另一种猫眼散景是当混叠圈落在入瞳或出瞳外时形成的。

- **生成散景**：在虚拟场景中生成散景有一个非常简单的方法。当为了模拟一个薄透镜模型而生成随机光线时，不是从一个单位圆中随机采样，而改为从一个散景图像中随机采样。散景图像是一个二维的灰度图，用以描述光圈的形状和分布概率。一个完美的校正散景图像就会是一个黑色背景上有一个灰色的圆形；一个过校散景的图像就会是一个灰色渐变（越靠近边缘越白）的圆形；一个失校散景的图像就会是一个灰色渐变（越靠近边缘越黑）的圆形。

- **对焦呼吸**：当镜头调整对焦时，焦距也会随之改变的现象。大部分镜头在拉近时会增加焦距，拉远时会减小焦距。

- **齐焦镜头**：调整焦距时焦点不变的镜头。电影镜头通常使用这类镜头，可以保证在镜头拉近或者拉远时不改变焦点。

- **可变焦距镜头**：调整焦距时焦点也会改变的镜头。可以在照片摄影中使用。

- **暗角**：从画面中心到画面边缘的曝光衰减。通常是由于机械组件遮挡或者镜头视界覆盖不足引起的。暗角可以通过后期效果增加或去除，但去除暗角可能会给图像引入噪声。

- **平直镜头**：没有镜头畸变的镜头。

- **畸变镜头**：具有镜头畸变的镜头。

- **桶形畸变**：使物象中心向外膨胀的畸变效果。

- **枕形畸变**：使物象中心向内收缩的畸变效果。

- **须状畸变**：同时出现桶形畸变和枕形畸变的畸变效果。

- **鱼眼镜头**：一种获取整个半球面画面的镜头，有严重的桶形畸变。

- **耀斑**：由高亮光源进入镜头后产生的涂抹光斑。光线会在镜头内部来回弹射，最终在照片上留下一个涂抹光斑。不同的镜头会产生各式各样的耀斑，但耀斑其实可以通过后期很容易地模拟出来，只需要找到画面中曝光最高地部分应用一个耀斑形状即可。不过该方法无法获取耀斑的射入角，这会失去耀斑中十分明显的光束特征。

- **球面像差**：球形光学元件产生的投射误差。平行射入的光线无法精确地汇聚到一点，使图片上出现像差。

- **中轴色差**：由于可见光各部分波长不同导致的焦距不同所产生的颜色像差。中轴色差会使没有落在焦平面上的物体颜色发生偏移。

- **横向色差**：由于可见光各部分波长不同汇聚半径所产生的横向色差，常表现为高对比度的物体边缘产生彩色边纹。

- **场曲**：聚焦成像的形状和方向。焦平面并不严格垂直于相机的中轴线，也并不是一个平直的平面，实际上是一个曲面。在计算机中，可以通过将模拟镜头的单位圆映射到一个曲面上来模拟场曲的效果。

- **衍射**：当电磁波衍射产生大于像素间距的干扰时，会使成像的物体边缘变得模糊。该现象通常发生在使用小光圈的时候。
